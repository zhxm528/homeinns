<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zai.availability.mapper.AvailabilityMapper">
    
    <!-- 批量插入价格数据 -->
    <insert id="batchInsertRatePrices" parameterType="java.util.List">
        INSERT INTO rate_prices (
            price_id, chain_id, hotel_id, hotel_code, rate_plan_id, 
            room_type_id, room_type_code, rate_code_id, rate_code, 
            stay_date, channel_single_occupancy, channel_double_occupancy,
            hotel_single_occupancy, hotel_double_occupancy,
            agent_single_occupancy, agent_double_occupancy
        ) VALUES 
        <foreach collection="list" item="item" separator=",">
            (
                #{item.priceId}, #{item.chainId}, #{item.hotelId}, #{item.hotelCode},
                #{item.ratePlanId}, #{item.roomTypeId}, #{item.roomTypeCode},
                #{item.rateCodeId}, #{item.rateCode}, #{item.stayDate},
                #{item.channelSingleOccupancy}, #{item.channelDoubleOccupancy},
                #{item.hotelSingleOccupancy}, #{item.hotelDoubleOccupancy},
                #{item.agentSingleOccupancy}, #{item.agentDoubleOccupancy}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
            channel_single_occupancy = VALUES(channel_single_occupancy),
            channel_double_occupancy = VALUES(channel_double_occupancy),
            hotel_single_occupancy = VALUES(hotel_single_occupancy),
            hotel_double_occupancy = VALUES(hotel_double_occupancy),
            agent_single_occupancy = VALUES(agent_single_occupancy),
            agent_double_occupancy = VALUES(agent_double_occupancy),
            updated_at = CURRENT_TIMESTAMP
    </insert>

    <!-- 批量插入库存状态数据 -->
    <insert id="batchInsertRateInventoryStatus" parameterType="java.util.List">
        INSERT INTO rate_inventory_status (
            status_id, chain_id, hotel_id, hotel_code, rate_plan_id,
            room_type_id, room_type_code, rate_code_id, rate_code,
            stay_date, is_available, remaining_inventory, sold_inventory,
            min_stay_days, max_stay_days, min_advance_days, max_advance_days,
            latest_cancel_days, latest_cancel_time_same_day, payment_type,
            latest_reservation_time_same_day, is_cancellable, cancel_penalty
        ) VALUES 
        <foreach collection="list" item="item" separator=",">
            (
                #{item.statusId}, #{item.chainId}, #{item.hotelId}, #{item.hotelCode},
                #{item.ratePlanId}, #{item.roomTypeId}, #{item.roomTypeCode},
                #{item.rateCodeId}, #{item.rateCode}, #{item.stayDate},
                #{item.isAvailable}, #{item.remainingInventory}, #{item.soldInventory},
                #{item.minStayDays}, #{item.maxStayDays}, #{item.minAdvanceDays},
                #{item.maxAdvanceDays}, #{item.latestCancelDays},
                #{item.latestCancelTimeSameDay}, #{item.paymentType},
                #{item.latestReservationTimeSameDay}, #{item.isCancellable},
                #{item.cancelPenalty}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
            is_available = VALUES(is_available),
            remaining_inventory = VALUES(remaining_inventory),
            sold_inventory = VALUES(sold_inventory),
            min_stay_days = VALUES(min_stay_days),
            max_stay_days = VALUES(max_stay_days),
            min_advance_days = VALUES(min_advance_days),
            max_advance_days = VALUES(max_advance_days),
            latest_cancel_days = VALUES(latest_cancel_days),
            latest_cancel_time_same_day = VALUES(latest_cancel_time_same_day),
            payment_type = VALUES(payment_type),
            latest_reservation_time_same_day = VALUES(latest_reservation_time_same_day),
            is_cancellable = VALUES(is_cancellable),
            cancel_penalty = VALUES(cancel_penalty),
            updated_at = CURRENT_TIMESTAMP
    </insert>
</mapper> 